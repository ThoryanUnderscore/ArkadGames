#!/bin/bash

# ---------- LABYRINTHES ----------
LAB1=(
"11111111111111111111111111111111111111111"
"14000000001000000000001000001000100000001"
"10111111101110111110111011111010111110111"
"10100000100000000000001010000010000010001"
"10101111111011101011101011101111111011101"
"10100000000010001000001000001000001010001"
"10101111111111111011101111111011111010111"
"10100000100000000010101000000000001010001"
"10111110101111111110101011111111101011101"
"10000010001000100000001000101000001000001"
"10111011111110101111111110101011101111101"
"10101000000010000000100000101000101000101"
"10101111111011111010101111101110101010101"
"10101000000010000010101000001000100010101"
"10101011111010111110101011101011111111101"
"10001010001010100010101000101000000000001"
"11101010101110101010101010101111111111111"
"10101010100000101010101010100010001000001"
"10101010111111101010101110111010101111101"
"10001000000000001010000000100000100000031"
"11111111111111111111111111111111111111111"
)



LAB2=(
"11111111111111111111111111111111111111111"
"14001000001000100000000000001000100000001"
"10101010111010101111111111101011101011101"
"10101010001010100010000000101000001010001"
"10101011101010111011101111101011111010111"
"10101010100010001000100000101000100010101"
"10101010111111101111101110101111101110101"
"10101000001000100010001010100000101000001"
"10101111101010111010111010111110101111101"
"10100000100010001000000010001000100010001"
"10111011111110111111111111101011111010111"
"10100010000000100000000000001000000010101"
"10111110111111101111111110111111111110101"
"10000010100000100000100000100000000010101"
"10111010111110111110111011101110111110101"
"10001000100010000010001000101010001000101"
"11101111101011111011101110101011101011101"
"10101000101010001000101000101000100010001"
"10101010101010101010101111101010111110101"
"10000010001000100010100000000010000000131"
"11111111111111111111111111111111111111111"
)



LAB3=(
"11111111111111111111111111111111111111111"
"14000000100000100010001000001000001000001"
"10101110101110101010101110101011101011111"
"10101000001000001000100000101000101000001"
"10101110111111111111111111101110101011101"
"10100010100010000000000010001000101010001"
"10111011101010111010111010111011101110101"
"10001000001000001010001010100000100000101"
"11101111111111111010101110111110111111101"
"10101000000010001010100010000000100010001"
"10101010101110111010111011111111101110111"
"10001010101000100010101000100010000000101"
"10111010111011111010101110101010111111101"
"10100010100010000010001000101010100000001"
"10111110101111101111111011101010111011111"
"10001000100000100000100010001010001000001"
"11101010111110111010101110111011101111101"
"10001010100010001010100010101000101000001"
"10111010111011101110101010101011101011101"
"10000010000000100000101000001000000010031"
"11111111111111111111111111111111111111111"
)




LABS=(LAB1 LAB2 LAB3)

# ---------- CHOIX DU LAB ----------
lab_index=$((RANDOM % 3))
lab_name=${LABS[$lab_index]}
eval "LAB=(\"\${$lab_name[@]}\")"

HEIGHT=${#LAB[@]}
WIDTH=${#LAB[0]}

# ---------- TROUVER ENTRÃ‰E ----------
for ((y=0; y<HEIGHT; y++)); do
    for ((x=0; x<WIDTH; x++)); do
        if [[ ${LAB[y]:x:1} == "4" ]]; then
            px=$x
            py=$y
        fi
    done
done

start_time=$(date +%s)

# ---------- BOUCLE DE JEU ----------
while true; do
    clear

    for ((y=0; y<HEIGHT; y++)); do
        for ((x=0; x<WIDTH; x++)); do
            if [[ $x -eq $px && $y -eq $py ]]; then
                printf "o"
            else
                case ${LAB[y]:x:1} in
                    1) printf "#" ;;
                    0|4) printf " " ;;
                    3) printf "S" ;;
                esac
            fi
        done
        echo
    done

    read -rsn1 key
    if [[ $key == $'\x1b' ]]; then
        read -rsn2 key
    fi

    nx=$px
    ny=$py

    case "$key" in
        z|$'\x1b[A') ((ny--)) ;;
        s|$'\x1b[B') ((ny++)) ;;
        q|$'\x1b[D') ((nx--)) ;;
        d|$'\x1b[C') ((nx++)) ;;
    esac

    cell=${LAB[ny]:nx:1}

    if [[ "$cell" == "1" ]]; then
        continue
    fi

    px=$nx
    py=$ny

    if [[ "$cell" == "3" ]]; then
        end_time=$(date +%s)
        clear
        echo "ðŸŽ‰ Sortie atteinte !"
        echo "Temps : $((end_time - start_time)) secondes"
        exit 0
    fi
done
